---
title: "STAT206 Final: Air Quality Dashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
runtime: shiny
---

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(dplyr)
library(shiny)
library(DT)

# Load the combined dataset once, globally
combined_data <- read.csv("combined_data.csv")
```

Column {data-width=650}
-----------------------------------------------------------------------

### Summary Table

```{r summary-table, message=FALSE}

# We calculate average and standard deviation of air quality and weather variables for each city

### Summary Table {.tabset .tabset-fade}

library(dplyr)
library(DT)

# Select only the numeric variables
vars <- c("aqi", "pm2_5", "pm10", "no2", "o3", "temperature", "humidity")

# Calculate mean and standard deviation for each city
summary_stats <- combined_data %>%
  group_by(city) %>%
  summarise(across(all_of(vars), 
                   list(mean = ~mean(. , na.rm = TRUE),
                        sd = ~sd(. , na.rm = TRUE)),
                   .names = "{.col}_{.fn}"))

# Show as interactive table
datatable(summary_stats, options = list(pageLength = 5), 
          caption = "Mean and SD of Air Quality & Climate Variables by City")


#This code: groups data by city, calculates average and standard deviation for each variable and displays everything as an interactive scrollable table

```

Column {data-width=350}
-----------------------------------------------------------------------

### Static Scatter Plot: PM2.5 vs AQI

```{r}
ggplot(combined_data, aes(x = pm2_5, y = aqi, color = city)) +
  geom_point(size = 3, alpha = 0.7) +
  labs(
    title = "PM2.5 vs AQI by City",
    x = expression("PM2.5 Concentration ("*mu*"g/m"^3*")"),
    y = "Air Quality Index (AQI)",
    color = "City"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16),
    axis.title = element_text(size = 14),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )
```


